dist_list={q1:[10.780612857979111,106.69929097226942,"Quận 1"],q2:[10.783647660067732,106.72673471144276,"Quận 2"],q3:[10.782833128986498,106.68617895544911,"Quận 3"],q4:[10.766619604634025,106.70496162697751,"Quận 4"],q5:[10.755963008464605,106.66749108555408,"Quận 5"],q6:[10.746598181717706,106.64917765698283,"Quận 6"],q7:[10.73233643049728,106.72664202853471,"Quận 7"],q8:[10.740319883142194,106.66541075067252,"Quận 8"],q9:[10.83982108902878,106.77095208740852,"Quận 9"],q10:[10.767918838830244,106.66659593804623,"Quận 10"],q11:[10.763904275145594,106.64342383825374,"Quận 11"],q12:[10.86324605768756,106.65438133369516,"Quận 12"],qbthanh:[10.803446284783773,106.69630236758046,"Quận Bình Thạnh"],qbtan:[10.737193840613681,106.61566486228712,"Quận Bình Tân"],qgvap:[10.831931525946937,106.66930567480965,"Quận Gò Vấp"],qpnhuan:[10.795230097898482,106.67533732496804,"Quận Phú Nhuận"],qtbinh:[10.797934622453923,106.64237067817248,"Quận Tân Bình"],qtphu:[10.783538492749958,106.63690663160116,"Quận Tân Phú"],hbchanh:[10.689936987473937,106.5841934376312,"Huyện Bình Chánh"],hcgio:[10.411275219925006,106.95473231899838,"Huyện Cần Giờ"],hcchi:[10.973555815067174,106.4938085691552,"Huyện Củ Chi"],hhmon:[10.889499705704482,106.59518769231617,"Huyện Hóc Môn"],hnbe:[10.674384007461548,106.73295641257327,"Huyện Nhà Bè"],tptduc:[10.775752803095694,106.7544347021429,"TP. Thủ Đức"]};var district_define=null,districtFeatures=[],markers=null,geojson=null,map=null,info=null;const fillOpacityDefault=1;function initMap(){for(var e in markers=L.layerGroup(),dist_list)L.marker([dist_list[e][0],dist_list[e][1]]).bindPopup(dist_list[e][2]).addTo(markers);var t='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',o="https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",a=L.tileLayer(o,{id:"mapbox/light-v9",tileSize:512,zoomOffset:-1,attribution:t}),r=L.tileLayer(o,{id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,attribution:t}),n=L.map("map",{center:[10.753286,106.662586],zoom:10,layers:[a]}),i={Grayscale:a,Streets:r},l={district_markers:markers};function s(e,t){t.on({mouseover:c,mouseout:d,click:u})}function c(e){var t=e.target;t.setStyle({weight:3,dashArray:"",fillOpacity:1}),L.Browser.ie||L.Browser.opera||L.Browser.edge||t.bringToFront(),info.update(t.feature.properties)}function d(e){e.target.setStyle({weight:1.25,dashArray:"3",fillOpacity:1})}function u(e){console.log(e.target.getBounds()),n.fitBounds(e.target.getBounds(),{padding:[20,10]})}L.control.layers(i,l).addTo(n),(info=L.control()).onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},info.update=function(e){var t=e&&e.name?dist_list[e.name][2]:"";this._div.innerHTML="<h4>Thành phố Hồ Chí Minh</h4>"+(e?"<p><b>"+t+"</b></p><p><b>"+e.product+"</b><br/>"+e.density+" "+e.unit+'</p><p style="text-align: right; margin-bottom: 0;"><i><small>'+e.date+"</small></i></p>":"")},info.addTo(n),$.getJSON("static/data/hcm-district/district_define.json",(function(e){district_define=e})),$.getJSON("static/data/hcm-district/district_geo.json",(function(e){var t=e.features;for(var o in t){var a=t[o].properties.AdminID;district_define[a].geometry=t[o].geometry}console.log("District list define: ",district_define);for(const[e,t]of Object.entries(district_define)){var r={type:"Feature",properties:{name:t.distId,date:"...",density:"...",unit:"µmol/㎡",product:"...",style:{weight:2.5,dashArray:"3",color:"#777",opacity:.6,fillColor:"#fff",fillOpacity:1},show_on_map:!0},geometry:{type:"MultiPolygon",coordinates:[t.geometry.coordinates]}};districtFeatures.push(r)}geojson=L.geoJSON(districtFeatures,{filter:function(e,t){return e.properties.show_on_map},style:function(e){return e.properties.style},onEachFeature:s}).bindPopup((function(e){return e.feature.properties.popupContent})).addTo(n)}))}const weekday=new Array(7);weekday[0]="Chủ nhật",weekday[1]="Thứ hai",weekday[2]="Thứ ba",weekday[3]="Thứ tư",weekday[4]="Thứ năm",weekday[5]="Thứ sáu",weekday[6]="Thứ bảy";const colorCodeRange=["#739f1d","#557e02","#4c6e06","#ffcc01","#ff9900","#ff6601","#cc3300","#cc0032","#990033","#d10000","#f30101"],product_list={no2:{id:"no2",label:"Nitrogen dioxide - NO₂",unit:"µmol/㎡",threshold:20,max:200},so2:{id:"so2",label:"Sulfur dioxide - SO₂",unit:"µmol/㎡",threshold:65,max:8e3},co:{id:"co",label:"Carbon monoxide - CO",unit:"µmol/㎡",threshold:1e4,max:8e4},hcho:{id:"hcho",label:"Formaldehyde - HCHO",unit:"µmol/㎡",threshold:20,max:800},o3:{id:"o3",label:"Ozone - O3",unit:"µmol/㎡",threshold:20,max:28e4}};function initNavDate(){new Date;for(var e=[],t=365;t>0;t--){const o=new Date;o.setDate(o.getDate()-t),e.push({date:formatDateDDMMYYYY(o),wkday:weekday[o.getDay()],class:1==t?"forecast":"actual"})}for(t=0;t<6;t++){const o=new Date;o.setDate(o.getDate()+t),e.push({date:formatDateDDMMYYYY(o),wkday:weekday[o.getDay()],class:0==t?"forecast current":"forecast"})}if(console.log("Date range",e),e.length){for(var t in $navDate=$("#navDate"),e)element='<li><a class="date '+e[t].class+'" data-value="'+e[t].date+'"><h4>'+e[t].wkday+"</h4><label>"+e[t].date+"</label></a></li>",$navDate.append(element);setTimeout((function(){$("a.date.current").trigger("click")}),200)}}function formatDateDDMMYYYY(e){var t=new Date(e),o=""+(t.getMonth()+1),a=""+t.getDate(),r=t.getFullYear();return o.length<2&&(o="0"+o),a.length<2&&(a="0"+a),[a,o,r].join("-")}function triggerGetData(){$(document).on("click","a.date",{param:1},(function(e){e.preventDefault();var t=$(this);$("a.date").removeClass("selected"),t.addClass("selected"),getDataByDate(t.attr("data-value"),$("#selectProduct").val(),t.hasClass("forecast"))}))}function getDataByDate(e,t,o){var a=o?"get-product-forecast":"get-product",r=e.split("-").reverse().join("-");$.get(a+"/all-dist/"+t+"/"+r,{}).done((function(t){console.log("Data on ",e,JSON.parse(t));var a=JSON.parse(t),r=setInterval((function(){if(console.log("GEO JSON NE: ",geojson),geojson){for(var e in districtFeatures){var t=districtFeatures[e].properties.name,n=(o?"<b>Dự báo: </b>":"<b>Sentinel-5P: </b>")+parseFloat(a.data[t]).toFixed(2),i=a.product_id,l=a.query_date;districtFeatures[e].properties.density=n,districtFeatures[e].properties.product=product_list[i].label,districtFeatures[e].properties.date=weekday[new Date(l).getDay()]+", "+formatDateDDMMYYYY(l)}console.log("Layer districtFeatures: ",districtFeatures),geojson.setStyle((function(e){var t=e.properties.name;console.log("==> value",t,a.data[t]);var o=a.data[t],r=a.product_id;return{fillColor:getColor(o,product_list[r].max,colorCodeRange),color:"#ffffff"}})),clearInterval(r)}}),250)}))}function getColor(e,t,o){var a;for(var r in o){if(!(e>=t/o.length*r))break;a=o[r]}return a}function initSelectProduct(){for(var e in product_list){var t=new Option(product_list[e].label,product_list[e].id);$(t).html(product_list[e].label),$("#selectProduct").append(t)}}function onChangeProduct(){$("#selectProduct").on("change",(function(e){console.log("Change product",e),geojson.resetStyle(),setColorLegend(colorCodeRange)}))}function setColorLegend(e){$("#colorLegend ul").find(".value").remove();for(var t=$("#selectProduct").val(),o=product_list[t].max,a=e.length-1;a>=0;a--){var r=o/(e.length-1)*a,n=e[a],i='<li class="value" style="background-color: '+n+"; color: "+invertColor(n,!0)+'";>'+nFormatter(r,1)+"</li>";$("#colorLegend ul").append(i)}}function invertColor(e,t){if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color.");var o=parseInt(e.slice(0,2),16),a=parseInt(e.slice(2,4),16),r=parseInt(e.slice(4,6),16);return t?.299*o+.587*a+.114*r>186?"#000000":"#FFFFFF":(o=(255-o).toString(16),a=(255-a).toString(16),r=(255-r).toString(16),"#"+padZero(o)+padZero(a)+padZero(r))}function nFormatter(e,t){var o,a=[{value:1,symbol:""},{value:1e3,symbol:"K"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(o=a.length-1;o>0&&!(e>=a[o].value);o--);return(e/a[o].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+a[o].symbol}$((function(){initMap(),initNavDate(),initSelectProduct(),onChangeProduct(),setColorLegend(colorCodeRange),triggerGetData()})),$(window).load((function(){}));
//# sourceMappingURL=main-dist.js.map