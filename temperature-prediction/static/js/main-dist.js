item_list={hcm:[10.7759,106.7013,"Thành phố Hồ Chí Minh","TP.HCM"],binhduong:[11.3254,106.477,"Tỉnh Bình Dương","Bình Dương"],binhphuoc:[11.5473,106.8832,"Tỉnh Bình Phước","Bình Phước"],dongnai:[11.0682,107.1678,"Tỉnh Đồng Nai","Đồng Nai"],tayninh:[11.3352,106.1099,"Tỉnh Tây Ninh","Tây Ninh"],vungtau:[10.508,107.1975,"Tỉnh Bà Rịa - Vũng Tàu","Bà Rịa - Vũng Tàu"]};var province_define=null,provinceFeatures=[],districtFeatures=[],markers=null,geojson=null,map=null,info=null;const fillOpacityDefault=1,opacityDefault=.6;function initMap(){for(var e in markers=L.layerGroup(),item_list){var t=L.divIcon({iconSize:[150,30],iconAnchor:[75,30],html:'<div class="map-label"><div class="map-label-content">'+item_list[e][3]+"</div></div>"});L.marker([item_list[e][0],item_list[e][1]],{icon:t}).addTo(markers)}var a='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',o="https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoidGFtdm4xNCIsImEiOiJjbG9vN283eHowMmQ2MmpxaXJ1ZTBtNHdpIn0.fL0XhDxrnTM7OJsAM-sw0A",n=L.tileLayer(o,{id:"mapbox/light-v9",tileSize:512,zoomOffset:-1,attribution:a}),r=L.tileLayer(o,{id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,attribution:a});satellite=L.tileLayer(o,{id:"mapbox/satellite-v9",tileSize:512,zoomOffset:-1,attribution:a}),(map=L.map("map",{center:[11.10165037285805,106.76075056221242],zoom:9,layers:[n]})).attributionControl.setPosition("topright");var i={Grayscale:n,Satellite:satellite,Streets:r},l={"Hiển thị tên địa điểm":markers};function s(e,t){t.on({mouseover:c,mouseout:d,click:u})}function c(e){var t=e.target;t.setStyle({weight:3,dashArray:"",opacity:.85,fillOpacity:1}),L.Browser.ie||L.Browser.opera||L.Browser.edge||t.bringToFront(),info.update(t.feature.properties),$(".info.leaflet-control").toggleClass("show",!0)}function d(e){e.target.setStyle({weight:1.25,dashArray:"3",fillOpacity:1,opacity:.6}),info.update(null),$(".info.leaflet-control").toggleClass("show",!1)}function u(e){console.log("Zoom to: ",e.target.getBounds()),map.fitBounds(e.target.getBounds(),{padding:[20,10]})}L.control.layers(i,l).addTo(map),(info=L.control()).onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},info.update=function(e){var t=e&&e.name?item_list[e.name][2]:"";this._div.innerHTML="<h4>Địa điểm</h4>"+(e?"<p><b>"+t+"</b></p><p>"+e.textType+'<b><span class="circle color" style="background-color: '+e.color+'"></span><span> '+e.density+"</span></b> "+e.unit+'</p><p style="text-align: right; margin-bottom: 0;"><i><small>'+e.date+"</small></i></p>":"")},info.addTo(map),$.getJSON("static/data/province/province_define.json",(function(e){province_define=e})),$.getJSON("static/data/province/province_geo.json",(function(e){var t=e.features;for(var a in t){var o=t[a].properties.AdminID;province_define[o].geometry=t[a].geometry}console.log("District list define: ",province_define);for(const[e,t]of Object.entries(province_define)){var n={type:"Feature",properties:{name:t.distId,date:"...",textType:"...",density:"...",unit:"℃",product:"...",color:"#fff",style:{weight:2.5,dashArray:"3",color:"#777777",opacity:.6,fillColor:"#a6a6a6",fillOpacity:1},show_on_map:!0},geometry:{type:"MultiPolygon",coordinates:[t.geometry.coordinates]}};districtFeatures.push(n)}geojson=L.geoJSON(districtFeatures,{filter:function(e,t){return e.properties.show_on_map},style:function(e){return e.properties.style},onEachFeature:s}).bindPopup((function(e){return e.feature.properties.popupContent})).addTo(map)}))}var district_data=[],future_count=5,dataStartDate="10/03/2023";const weekday=new Array(7);weekday[0]="Chủ nhật",weekday[1]="Thứ hai",weekday[2]="Thứ ba",weekday[3]="Thứ tư",weekday[4]="Thứ năm",weekday[5]="Thứ sáu",weekday[6]="Thứ bảy";var playStatus=0;const colorCodeRange=["#1d10ff","#3f66ff","#b1d2f4","#5dd5d1","#258200","#9fcf00","#f9cf00","#f66401","#f70000"],product_list={temperature:{id:"temperature",label:"°C",unit:"°C",unitConvert:"°C",threshold:20,max:40}};var dateSwiper;function initSelectDistrict(){$.get("/get-district-all",{}).done((function(e){for(var t in district_data=JSON.parse(e)){var a=new Option(district_data[t].dist_name,district_data[t]._id);$(a).html(district_data[t].dist_name),$("#selectDistrict").append(a)}}))}function onChangeDistrict(){$("#selectDistrict").on("change",(function(e){console.log("Zoom to district",e,$(this).val());var t=$(this).val();for(var a in geojson._layers)if(geojson._layers[a].feature.properties.name==t){var o=geojson._layers[a]._bounds;map.fitBounds(o,{padding:[20,10]})}}))}function initDateInput(){$("#date").datepicker({showOn:"both",dateFormat:"dd-mm-yy",regional:"vi"}).on("change",(function(){var e=$(this).val();$("a.date[data-value="+e+"]").click()})),$("#date").datepicker("setDate",new Date);var e=new Date;e.setDate(e.getDate()+future_count),$("#date").datepicker("option","minDate",new Date(dataStartDate)),$("#date").datepicker("option","maxDate",e)}function initDateSwiper(){dateSwiper=new Swiper(".dateSwiper",{slidesPerView:"auto",spaceBetween:15,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},on:{init:function(){console.log("swiper initialized")},afterInit:function(){console.log("after initialized",dateSwiper);var e=getAvaiableDate();if(console.log("Date range",e),e.length){for(var t=[],a=e.length-1;a>0;a--)element='<a class="swiper-slide date '+e[a].class+'" data-value="'+e[a].date+'" data-index="'+a+'"><h4>'+e[a].wkday+"</h4><label>"+e[a].date+"</label></a>",t.push(element);setTimeout((function(){dateSwiper.prependSlide(t)}),1500),setTimeout((function(){$("a.date.current").trigger("click")}),1500)}},slidesLengthChange:function(){$("a.date.current").trigger("click")}}})}function getAvaiableDate(){var e=new Date,t=new Date(dataStartDate);const a=Math.abs(e-t);for(var o=[],n=Math.ceil(a/864e5)-1+1;n>0;n--){const e=new Date;e.setDate(e.getDate()-n),o.push({date:formatDateDDMMYYYY(e),wkday:weekday[e.getDay()],class:0==n?"forecast":"actual"})}for(n=0;n<future_count+1;n++){const e=new Date;e.setDate(e.getDate()+n),o.push({date:formatDateDDMMYYYY(e),wkday:weekday[e.getDay()],class:0==n?"forecast current":"forecast"})}return o}function formatDateDDMMYYYY(e){var t=new Date(e),a=""+(t.getMonth()+1),o=""+t.getDate(),n=t.getFullYear();return a.length<2&&(a="0"+a),o.length<2&&(o="0"+o),[o,a,n].join("-")}function triggerGetData(){$(document).on("click","a.date",{param:1},(function(e){e.preventDefault(),console.log("On click button!!!!!!");var t=$(this);$("a.date").removeClass("selected"),t.addClass("selected");var a=parseInt(t.attr("data-index"))-1,o=t.attr("data-value");$("#date").datepicker("setDate",o),dateSwiper.slideTo(a),getDataByDate(t.attr("data-value"),$("#selectProduct").val(),t.hasClass("forecast"))}))}function getDataByDate(e,t,a){let o={product_id:"temperture",query_date:"2023-11-11",data:{vungtau:10,dongnai:20,binhphuoc:15,tayninh:32,hcm:41,binhduong:33}};console.log("Data on ",e,o);var n=o.query_date,r=setInterval((function(){if(geojson){for(var e in districtFeatures){var t=districtFeatures[e].properties.name,i=parseFloat(o.data[t]).toFixed(2),l=Number(i).toLocaleString("vi-VN");console.log("density_val: ",l),districtFeatures[e].properties.textType=a?"<b>Dự báo: </b>":"<b>Trạm đo tên gì: </b>",districtFeatures[e].properties.density=l,districtFeatures[e].properties.color=getColor(i,50,colorCodeRange),districtFeatures[e].properties.date=weekday[new Date(n).getDay()]+", "+formatDateDDMMYYYY(n)}geojson.setStyle((function(e){var t=e.properties.name;return{fillColor:getColor(o.data[t],50,colorCodeRange),color:"#ffffff"}})),clearInterval(r)}}),250)}function getColor(e,t,a){var o="#a6a6a6";for(var n in a){if(!(e>=t/a.length*n))break;o=a[n]}return o}function initSelectProduct(){for(var e in product_list){var t=new Option(product_list[e].label,product_list[e].id);$(t).html(product_list[e].label),$("#selectProduct").append(t)}}function onChangeProduct(){$("#selectProduct").on("change",(function(e){console.log("Change product",e,$(this).val()),geojson.resetStyle(),setColorLegend(colorCodeRange),$("a.date.current").click()}))}function setColorLegend(e){$("#colorLegend ul").find(".value").remove();const t=$("#selectProduct").val(),a=product_list[t].max,o=product_list[t].unit;$("#product-unit.unit").html(o);for(var n=e.length-1;n>=0;n--){var r=a/(e.length-1)*n,i=e[n],l=e.length-1===n?"+":"",s='<li class="value" style="background-color: '+i+"; color: "+invertColor(i,!0)+'";>'+nFormatter(r,1)+l+"</li>";$("#colorLegend ul").append(s)}}function invertColor(e,t){if(0===e.indexOf("#")&&(e=e.slice(1)),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),6!==e.length)throw new Error("Invalid HEX color.");var a=parseInt(e.slice(0,2),16),o=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16);return t?.299*a+.587*o+.114*n>186?"#000000":"#FFFFFF":(a=(255-a).toString(16),o=(255-o).toString(16),n=(255-n).toString(16),"#"+padZero(a)+padZero(o)+padZero(n))}function nFormatter(e,t){var a,o=[{value:1,symbol:""},{value:1e3,symbol:"K"},{value:1e6,symbol:"M"},{value:1e9,symbol:"G"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}];for(a=o.length-1;a>0&&!(e>=o[a].value);a--);return(e/o[a].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+o[a].symbol}function triggerPlay(){var e,t=1;$(".control-date ul li a").click((function(a){a.preventDefault();var o=$(this).attr("data-type");switch(console.log("type = ",o),o){case"prev":console.log("Click previous!");var n=$("a.date.selected").prev();n.length&&n.trigger("click");break;case"next":console.log("Click next!");var r=$("a.date.selected").next();r.length&&r.trigger("click");break;default:$(this).hasClass("readyToStop")?(t=-1,$(this).removeClass("readyToStop")):(t=1,$(this).addClass("readyToStop")),t?e=setInterval((function(){if(1==t){var a=$("a.date.selected").next();a.length&&a.trigger("click")}else clearInterval(e)}),2e3):clearInterval(e)}}))}function formatDateYYYYMMDD(e){var t=e.split("-");return t[2]+"-"+t[1]+"-"+t[0]}$((function(){initMap(),initSelectDistrict(),onChangeDistrict(),initSelectProduct(),onChangeProduct(),setColorLegend(colorCodeRange),triggerGetData(),triggerPlay(),initDateInput(),initDateSwiper()}));
//# sourceMappingURL=main-dist.js.map