var district_data=[],product_dist_data=[];const product_list={no2:{id:"no2",label:"Nitrogen dioxide - NO₂",unit:"µmol/㎡",threshold:20},so2:{id:"so2",label:"Sulfur dioxide - SO₂",unit:"µmol/㎡",threshold:65},co:{id:"co",label:"Carbon monoxide - CO",unit:"µmol/㎡",threshold:1e4},hcho:{id:"hcho",label:"Formaldehyde - HCHO",unit:"µmol/㎡",threshold:20},o3:{id:"o3",label:"Ozone - O3",unit:"µmol/㎡",threshold:0},pm25:{id:"pm25",label:"Bụi mịn PM2.5",unit:"µg/m³",threshold:20,max:500}};function customRange(t){if("todate"==t.id){var e=new Date($("#fromdate").val());return e.setDate(e.getDate()+1),{minDate:e}}return{}}function formatDateYYYYMMDD(t){var e=t.split("-");return e[2]+"-"+e[1]+"-"+e[0]}var ctx=null,my_chart=null;function initChart(){(ctx=document.getElementById("my_chart").getContext("2d")).fillStyle="white",my_chart=new Chart(ctx,{type:"line",data:{labels:[],datasets:[]},options:{scales:{y:{suggestedMax:50,suggestedMin:0,beginAtZero:!0}},responsive:!0,plugins:{export:{enabled:!0}}}})}function triggerDownloadChartImg(){$("#btn-download-chart").click((function(){var t=$("#fromdate").val(),e=$("#todate").val(),a=$("#selectDistrict").find(":selected").val(),o=$("#selectProduct").find(":selected").val(),r=document.createElement("a");r.href=getChartImgBase64(my_chart),r.download=o+"_"+a+"_"+t+"_"+e+".png",console.log(r),r.click()}))}function getChartImgBase64(t){return t.toBase64Image()}function triggerDownloadExcel(){$("#btn-download-excel").click((function(){console.log("Export Excel File",product_dist_data);var t=[],e=product_dist_data.dist._id,a=$("#fromdate").val(),o=$("#todate").val(),r=$("#selectDistrict").find(":selected").val(),d=$("#selectProduct").find(":selected").val();if(product_dist_data.data&&product_dist_data.data.length){var n=product_dist_data.data;for(var i in n){var l={Location:e,Date:n[i].date,Value:parseFloat(n[i].val).toFixed(2),Forecast:""};t.push(l)}}if(product_dist_data.data_pred&&product_dist_data.data_pred.length){n=product_dist_data.data_pred;for(var i in n){l={Location:e,Date:n[i].date,Value:"",Forecast:parseFloat(n[i].val_pred).toFixed(2)};t.push(l)}}console.log("Excel data: ",t),JSONToCSVConvertor(t,d+"_"+r+"_"+a+"_"+o,!0)}))}function JSONToCSVConvertor(t,e,a){var o="object"!=typeof t?JSON.parse(t):t,r="sep=,\r\n\n";if(a){var d="";for(var n in o[0])d+=n+",";r+=(d=d.slice(0,-1))+"\r\n"}for(var i=0;i<o.length;i++){d="";for(var n in o[i])d+='"'+o[i][n]+'",';d.slice(0,d.length-1),r+=d+"\r\n"}if(""!=r){var l="";l+=e.replace(/ /g,"_");var c="data:text/csv;charset=utf-8,"+escape(r),s=document.createElement("a");s.href=c,s.style="visibility:hidden",s.download=l+".csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}else alert("Invalid data")}function LoadArea(){var t=[{value:"hcm",text:"Thành phố Hồ Chí Minh"},{value:"binhduong",text:"Bình Dương"},{value:"bariavungtau",text:"Bà Rịa - Vũng Tàu"},{value:"dongnai",text:"Đồng Nai"},{value:"tayninh",text:"Tây Ninh"},{value:"binhphuoc",text:"Bình Phước"},{value:"binhthuan",text:"Bình Thuận"}];for(var e in t){var a=new Option(t[e].text,t[e].value);$(a).html(t[e].text),$("#selectDistrict").append(a)}}$((function(){for(var t in $("#fromdate, #todate").datepicker({showOn:"both",beforeShow:customRange,dateFormat:"dd-mm-yy",regional:"vi"}),$("#fromdate").datepicker("setDate",-7),$("#todate").datepicker("setDate",5),product_list){var e=new Option(product_list[t].label,product_list[t].id);$(e).html(product_list[t].label),$("#selectProduct").append(e)}LoadArea(),initChart(),$("#retriveData").click((function(){var t=formatDateYYYYMMDD($("#fromdate").val()),e=formatDateYYYYMMDD($("#todate").val());if(t>e)alert("Ngày bắt đầu phải bé hơn ngày kết thúc.");else{console.log(t);var a=[],o=[],r=[];my_chart.data.datasets=[];for(var d=new Date(t),n=new Date(e);d<=n;){var i=d.toLocaleDateString("en-US",{day:"numeric",month:"numeric",year:"numeric"});Math.random(),Math.random();a.push(i),d.setDate(d.getDate()+1)}var l=JSON.stringify(o),c=JSON.stringify(r);console.log("_data",l),console.log("_data_pred",c),o=[24,25,24,24,23,23,23,23,24,24,25,25,26,26,26,25,25,25,24,24,26,27,27,26,24,25,26,24,23,23,25],my_chart.data.datasets.push({label:"Giá trị thực tế",data:o,fill:!0,borderColor:"#ff4d4d",backgroundColor:"rgba(0, 0, 0, 0)",tension:.35,borderWidth:2,pointBorderWidth:1.23,pointRadius:1.5}),my_chart.data.datasets.push({label:"Giá trị dự báo",data:r,fill:!0,borderColor:"#95adbe",backgroundColor:"rgba(0, 0, 0, 0)",tension:.35,borderWidth:2,pointBorderWidth:1.23,pointRadius:1.5}),my_chart.data.labels=a,my_chart.options={scales:{yAxes:[{ticks:{suggestedMin:0,suggestedMax:50}}]},plugins:{legend:{position:"top"},title:{display:!0,text:"Nhiệt độ không khí tầm 2 mét",position:"top",font:{size:15},padding:{top:10,bottom:12}},tooltip:{titleFont:{size:14,lineHeight:1.5},bodyFont:{size:13.2,lineHeight:1.4},padding:10,caretPadding:5,callbacks:{beforeTitle:function(t){return"Nhiệt độ"},title:function(t){return"Ngày: "+t[0].label},label:function(t){return" "+t.dataset.label+": "+t.formattedValue.toLocaleString("vi-VN")+" °C"}}},export:{enabled:!0}}},my_chart.update()}})),triggerDownloadChartImg(),triggerDownloadExcel(),$("[data-toggle='tooltip']").tooltip()}));
//# sourceMappingURL=statistic-dist.js.map